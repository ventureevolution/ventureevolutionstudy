<!-- Styling of the page -->
<style type="text/css">
	.stage7a3-button {
        width: 60%;
        overflow: visible;
        white-space: normal;
        margin: 5px 0 5px 0;
    }
    #stage7a3-company-name{
        font-weight: bold;
	    text-transform: capitalize;
    }
    #tabling {
	    padding-top: 80px;
    }
    .navbar.navbar-default{
	    background-image: none;
	    background-color:#ffffff;
	    border: none;
	    box-shadow: none;
	    -webkit-box-shadow: none;
    }
    body.dragging, body.dragging * {
	  cursor: move !important;
	}
	
	.dragged {
	  position: absolute;
	  opacity: 0.5;
	  z-index: 2000;
	}
	ol.connectedSortable {
		width: 100%;
		position: relative;
		display: inline-block;
		*display: inline;
		border-radius: 5px;
		padding: 20px;
		color: #fff;
		min-height: 200px;
	}
	#stage7a3-sortable1 {
		border: 2px solid #C0C0C0;
	}
	#stage7a3-sortable2 {
		border: 2px solid #8AC007;
	}
	ol.connectedSortable li.placeholder {
	  position: relative;
	  /** More li styles **/
	}
	ol.connectedSortable li.placeholder:before {
	  position: absolute;
	  /** Define arrowhead **/
	}
	.backgroundtext {
		position: absolute;
		top: 50px;
		left: 0;
		color: darkgrey;
		text-align: center;
		width: 100%;
	}
	#nextPage{
		margin-top: 10px;
	}
	#stage7a3-sidebar-number{
		font-size: 40px;
	    line-height: 1.33;
	    padding: 25px;
	}
</style>
<!-- Dialog Message Area -->
<div id="stage7a3-dialog-message-proceed">
	<p><div id="S7A3P6" class="textreplace"></div></p>
</div>
<div id="stage7a3-dialog-message-error">
	<p><div id="S7A3P5" class="textreplace"></div></p>
</div>
<!-- Content of the page -->
<nav class="navbar navbar-default navbar-fixed-top">
	<div class="row">
		<div class="col-md-8 col-md-offset-2">
			<p><div id="S7A3P1" class="textreplace"></div><span class="stage7a3-company-name"></span><div id="S7A3P2" class="textreplace"></div></p>
		</div>
	</div>
</nav>
<div class="row">
	<div class="col-md-4 col-md-offset-2">
		<ol id="stage7a3-sortable1" class="connectedSortable"></ol>
	</div>
	<div class="col-md-4" id="stage7a3-sortable2-container">
		<div class="row">
			<div class="col-md-2" id="stage7a3-sidebar-number"></div>
			<div class="col-md-10">
				<ol id="stage7a3-sortable2" class="connectedSortable"></ol>
			</div>
		</div>
	</div>
</div>
<div class="row">
	<div class="col-md-8 col-md-offset-2">
		<center><button class="btn btn-success" id="nextPage"><div id="S7A3P3" class="textreplace"></div></button></center>
	</div>
</div>
<!-- Script of the page -->
<script src='js/jquery-sortable.js'></script>
<script type="text/javascript">
languageReplace();

$( document ).ready(function() {

	$(".stage7a3-company-name").append(mycompanydata[0]);
	
	var combinedStage7Aspects = [];
	
	//Insert elements from stage7a1aspects
	for(var aspectCounter1 in stage7a1aspects){
		if(combinedStage7Aspects.indexOf(stage7a1aspects[aspectCounter1]) < 0){
			combinedStage7Aspects.push(stage7a1aspects[aspectCounter1]);
		}
	}
	//Insert elements from stage7a2aspects
	for(var aspectCounter2 in stage7a2aspects){
		if(combinedStage7Aspects.indexOf(stage7a2aspects[aspectCounter2]) < 0){
			combinedStage7Aspects.push(stage7a2aspects[aspectCounter2]);
		}
	}
	
    //Insert the merge aspects into the sortable OL #stage7a3-sortable1
    
	for(var stage7a3Loop in combinedStage7Aspects){
        $("#stage7a3-sortable1").append('<li class="btn btn-danger btn-lg stage7a3-button" value="'+combinedStage7Aspects[stage7a3Loop]+'">'+combinedStage7Aspects[stage7a3Loop]+'&nbsp;</li>');
        
        var internalCount = parseInt(stage7a3Loop) + 1;
        $('#stage7a3-sidebar-number').append(internalCount+'<br>');
    }
	
	//Initialize sortable after creating the buttons
	$(function() {
		
		//Check if #stage7a3-sortable2 is empty, if so add the background text
		if($('#stage7a3-sortable2 li').length == 0){
			$('#stage7a3-sortable2').append('<div class="backgroundtext">'+languageReplacement['S7A3P4']+'</div>');
		}
		
		var adjustment;

		$("ol.connectedSortable").sortable({
		  group: 'connectedSortable',
		  pullPlaceholder: false,
		  // animation on drop
		  onDrop: function  ($item, container, _super) {
			var $clonedItem = $('<li/>').css({height: 0});
			$item.before($clonedItem);
			$clonedItem.animate({'height': $item.height()});

			$item.animate($clonedItem.position(), function  () {
			  $clonedItem.detach();
			  _super($item, container);
			});
			if($('#stage7a3-sortable2 li').length == 0){
				$('#stage7a3-sortable2').append('<div class="backgroundtext">'+languageReplacement['S7A3P4']+'</div>');
			}else{
				$('#stage7a3-sortable2 .backgroundtext').remove();
			}
		  },

		  // set $item relative to cursor position
		  onDragStart: function ($item, container, _super) {
			var offset = $item.offset(),
				pointer = container.rootGroup.pointer;

			adjustment = {
			  left: pointer.left - offset.left,
			  top: pointer.top - offset.top
			};

			_super($item, container);
		  },
		  onDrag: function ($item, position) {
			$item.css({
			  left: position.left - adjustment.left,
			  top: position.top - adjustment.top
			});
		  }
		});
	});

	 $("#nextPage").click(function(){
	 
		//Check if #stage7a3-sortable1 is empty, ONLY ALLOW to PROCEED when #stage7a3-sortable1 is empty
		if($('#stage7a3-sortable1 li').length == 0){
			debug("stage7a3 - sortable1 is empty and proceed to save");
			$( "#stage7a3-dialog-message-proceed" ).dialog( "open" );
		}else{
			debug("stage7a3 - sortable1 is not empty");
			$( "#stage7a3-dialog-message-error" ).dialog( "open" );
		}
    });
    
    //Dialog function
	$(function() {
		$( "#stage7a3-dialog-message-proceed" ).dialog({
			autoOpen: false,
			modal: true,
			buttons: {
				Yes: function() {
					//Save the data
			        savestage7a3data();
			        
			        //Close the dialog
			        $(this).dialog( "close" );
			        
			        //Change the loading image
			        $("#nextPage").empty();
			        $("#nextPage").append('<span class="glyphicon glyphicon-cog next-rotation-animate"></span> Loading');
			        //Change stage count and jump to next stage
			        stageCurrentStage++;
			        runStage(stages[stageCurrentStage]);
				},
				No: function(){
					//Close the dialog
			        $(this).dialog( "close" );
				}
			}
		});
		$( "#stage7a3-dialog-message-error" ).dialog({
			autoOpen: false,
			modal: true,
			buttons:{
				Ok: function(){
					//Close the dialog
			        $(this).dialog( "close" );
				}
			}
		});
	});
    
    function savestage7a3data(){
	    
	    debug("stage7a3 savestage7a3data() running");
	    
	    $('#stage7a3-sortable2 li').each(function(){
			var theValue = $(this).val();
			//append into stage7a3aspects
			stage7a3aspects.push(theValue);
		});
        
        debug("stage7a3aspects: "+stage7a3aspects);
    }
});
</script>