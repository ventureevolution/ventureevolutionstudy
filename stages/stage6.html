<!-- Styling of the page -->
<style>

/* Slider styling */      
#steps-fivepercent-slider .ui-slider-tip {
    visibility: visible;
    opacity: 1;
    top: -30px;
}

.slider-row{
	margin: 0 0 18px 0;
}

.slider{
	width:95%;
	display: inline-block;
	*display: inline;
	vertical-align: top;
}

.slider-input {
	display: none;
}
/* End of slider styling */
.stage6-competitor-name {
	font-weight: bold;
    text-transform: capitalize;
}

.ui-slider-label {
	display: none;
}

.ui-slider-pips .ui-slider-pip-selected-initial-first{
	color: #999 !important;
	font-weight: normal !important;
}

.ui-slider-pips .ui-slider-pip-selected-first {
	color: #999 !important;
	font-weight: normal !important;	
}

.slider-overlay{
    position: absolute;
    display: block;
    top: 0;
    margin-left: -15px;
    width: 100%;
    height: 120%;
    z-index: 100;
    background-color: rgba(192,192,192,0.3);
}
.stage6-col-left-align{
    text-align: right;
    padding-right: 0;
    padding-left: 0;
    font-weight: bold;
}
.stage6-col-right-align{
    padding-right: 0;
    padding-left: 0;
    font-weight: bold;
}
.stage6-col-na-box{
    padding-right: 0;
    margin-top: -8px;
}
.slider-group {
	margin-top: 4px;
}
button.ui-button.ui-widget.ui-state-default.ui-corner-all.ui-button-icon-only.ui-dialog-titlebar-close{
	    display: none;
}
#tabling {
    padding-top: 200px;
}
.navbar.navbar-default{
	padding-top: 30px;
    background-image: none;
    background-color:#ffffff;
    border: none;
    box-shadow: none;
    -webkit-box-shadow: none;
}
#stage6-top{
	padding-top: 0px;
}
</style>
<!-- Dialog Message Area -->
<div id="stage6-dialog-message">
  <p>
    <div id="S6P9" class="textreplace"></div>
  </p>
</div>
<!-- Content of the page -->
<nav class="navbar navbar-default navbar-fixed-top">
	<div class="row">
		<div class="col-md-8 col-md-offset-2">
			<center><p><div id="S6P1" class="textreplace"></div><span class="stage6-competitor-name"></span><div id="S6P2" class="textreplace"></div><span class="stage6-competitor-name"></span><div id="S6P3" class="textreplace"></div></p></center><br><br>
		</div>
	</div>
</nav>
<div id="stage6-top">&nbsp;</div>
<div class="row">
	<div class="col-md-9 col-md-offset-1" id="stage6-form">
	</div>
</div>
<div class="row" id ="stage6-next">
</div>
<!-- Script of the page -->
<!-- This is for sliders -->
<script src="js/jquery-2.1.1.js"></script>
<script src="js/jquery-ui.min.js"></script>
<script src="js/jquery-ui-slider-pips.js"></script>
<script>

debug("Stage6 - language replace");
languageReplace();
debug("Stage6 - title replace");
$("#stage6-dialog-message").attr("title",languageReplacement['S6P10']);

$( document ).ready(function() {
	
	//Step 1: Set construct order
	//Get number of attributes
	debug("Stage6 - term attribute data");
	var stage6AttributeNumber = attributedata.length;
	
	var stage6AttributeOrderArray = [];

	var stage6GlobalAttributeCounter = 0;

	debug("Stage6 - loop attribute number");
	while(stage6GlobalAttributeCounter < stage6AttributeNumber){
		
		//Insert into array either 1 or 2 (1: will be used for order Original Attribute vs Opposite Attribute, 2: will be used for order Opposite Attribute vs Original Attribute)
		stage6AttributeOrderArray.push(Math.floor((Math.random() * 2) + 1));
		
		stage6GlobalAttributeCounter++;
	}
	
	//Store in global order attribute array
	attributeOrder = stage6AttributeOrderArray.slice();
	
	//Randomize the attribute display sequence
	debug("Stage 6 - generate attribute sequence");
	attributeSequence = generateRandomSequenceArray(attributedata.length);
	
	debug("Stage 6 attribute sequence: " + attributeSequence.join(","));
	
	//Randomize the company display sequence
	debug("Stage 6 - generate company sequence");
	companySequence = generateRandomSequenceArray(parseInt(pointdata.length) + 2);
	
	debug("Stage 6 company sequence: " + companySequence.join(","));
	
	//Store the Ideal Self ID
	idealSelfid = parseInt(pointdata.length);
	currentSelfid = parseInt(pointdata.length) + 1;
	
	debug("Stage 6 ideal self id: " + idealSelfid);
	
	//Step 2: create pagination
	//Set initial page number
	var stage6PageNumber = 0;
	
	var stage6MaxPageNumber = parseInt(pointdata.length) + 1;
	
	debug("Stage6 - stage6 - stage6MaxPageNumber: "+stage6MaxPageNumber);
	
	stage6RunPage(stage6PageNumber);
	
	//Switch page function
	function stage6RunPage(pageNumber){
		
		debug("Stage6 - stage6RunPage() running");
		
		//Reset the display
		stage6ResetDisplay(pageNumber);
		
		stage6DisplayScale();
		
		//Display next button trigger
		if((stage6PageNumber >= 0) && (stage6PageNumber <= (stage6MaxPageNumber - 1))){
			
			debug("Stage6 stage number: "+stage6PageNumber);
			//Display next button
			$("#stage6-next").append('<div class="col-md-8 col-md-offset-2"><center>'+languageReplacement['S6P4']+'<br><br><button class="btn btn-success" id="nextPage">'+languageReplacement['S6P5']+'</button></center></div>');
			
			//Enable the next page function
			$("#nextPage").click(function(){
				
				var stage6CheckSlidersOption = stage6CheckSliders();
				
				if(stage6CheckSlidersOption == 1){
					debug("Stage6 - stage6RunPage() - next stage");
				
					//Save the data for this page
					stage6SaveScaleData(stage6PageNumber);
					
					//Change the loading image
                    $("#nextPage").empty();
                    $("#nextPage").append('<span class="glyphicon glyphicon-cog next-rotation-animate"></span> Loading');
					
					//Make increament to go to next page
					stage6PageNumber++;
					
					//Go to next page
					stage6RunPage(stage6PageNumber);	
					$('html,body').animate({scrollTop:$('#stage6-top').offset().top},1000);
				}else{
					//Pop up dialog box to prompt user input
					debug("Stage6 - Dialog box prompted");
					stage6RunDialog();
				}
				
			});
			
		}else if((stage6PageNumber > (stage6MaxPageNumber - 2)) && (stage6PageNumber < (stage6MaxPageNumber - 1))){
			
			debug("Stage6 stage number: "+stage6PageNumber);
			
			$("#stage6-next").append('<div class="col-md-8 col-md-offset-2"><center>'+languageReplacement['S6P6']+'<br><br><button class="btn btn-success" id="nextPage">'+languageReplacement['S6P7']+'</button></center></div>');
			
			//Enable the complete button
			$("#nextPage").click(function(){
				
				var stage6CheckSlidersOption = stage6CheckSliders();
				
				if(stage6CheckSlidersOption == 1){
				
					debug("Stage6 - stage6RunPage() - Quiz completed!");
					
					//Save the data for this page
					stage6SaveScaleData(stage6PageNumber);
					
                    //Change the loading image
                    $("#nextPage").empty();
                    $("#nextPage").append('<span class="glyphicon glyphicon-cog next-rotation-animate"></span> Loading');
                    
					//Make increament to go to next page
					stage6PageNumber++;
				
				}else{
					//Pop up dialog box to prompt user input
					debug("Stage6 - Dialog box prompted");
					stage6RunDialog();
				}
				
			});
			
		}
		else if(stage6PageNumber > (stage6MaxPageNumber - 1)){
			
			$("#stage6-next").append('<div class="col-md-8 col-md-offset-2"><center>'+languageReplacement['S6P6']+'<br><br><button class="btn btn-success" id="nextPage">'+languageReplacement['S6P7']+'</button></center></div>');
			
			//Enable the complete button
			$("#nextPage").click(function(){
				
				var stage6CheckSlidersOption = stage6CheckSliders();
				
				if(stage6CheckSlidersOption == 1){
				
					debug("Stage6 - stage6RunPage() - Quiz completed!");
					
					//Save the data for this page
					stage6SaveScaleData(stage6PageNumber);
					
                    //Change the loading image
                    $("#nextPage").empty();
                    $("#nextPage").append('<span class="glyphicon glyphicon-cog next-rotation-animate"></span> Loading');
                    
					//Change stage count and jump to next stage
					stageCurrentStage++;
					runStage(stages[stageCurrentStage]);
				
				}else{
					//Pop up dialog box to prompt user input
					debug("Stage6 - Dialog box prompted");
					stage6RunDialog();
				}
				
			});
			
		}
	}
	
	//Reset the display
	function stage6ResetDisplay(pageNumber){
		
		debug("Stage6 - stage6ResetDisplay() running");
		
		debug("Stage6 - stage6ResetDisplay() - reset display: "+pageNumber);
		
		//Clear the fields
		$(".stage6-competitor-name").empty();
		$("#stage6-form").empty();
		$("#stage6-next").empty();
		
		debug("Stage6 - stage6ResetDisplay() - pointdata: "+pointdata);
		
		var tempArraySelectedID = companySequence[parseInt(pageNumber)];
		
		debug("Stage6 - stage6ResetDisplay() - tempArraySelectedID: " + tempArraySelectedID);
		
		//If its equals to the ideal self
		if(tempArraySelectedID == idealSelfid){
			$(".stage6-competitor-name").append(languageReplacement['S6P8']+mycompanydata[0]);
		}else if(tempArraySelectedID == currentSelfid){
			$(".stage6-competitor-name").append(mycompanydata[0]);
		}else{
			$(".stage6-competitor-name").append(pointdata[tempArraySelectedID][0]);
		}
	}
	
	
	
	//Display the scales
	function stage6DisplayScale(){
		
		debug("Stage6 - stage6DisplayScale() running");
		
		var stage6DisplayScaleCounter = 0;
		
		//Use a loop to load each row individually
		while(stage6DisplayScaleCounter < stage6AttributeNumber){
			
			debug("Stage6 - stage6DisplayScale() - loop: "+stage6DisplayScaleCounter);
			
			var displayTextPair = stage6DisplayScaleOrderingOutput(stage6AttributeOrderArray[stage6DisplayScaleCounter], stage6DisplayScaleCounter);
			
			$("#stage6-form").append('<div class="row slider-row" id="attribute-slider-'+attributeSequence[stage6DisplayScaleCounter]+'"><div class="col-md-3 stage6-col-left-align">'+displayTextPair[0]+'</div><div class="col-md-5 slider-location"><center><div class="slider-group"><div class="slider"></div><input id="attribute-slider-input-'+attributeSequence[stage6DisplayScaleCounter]+'" class="slider-input form-control" type="text" disabled></div></center></div><div class="col-md-3 stage6-col-right-align">'+displayTextPair[1]+'</div><div class="col-md-1 stage6-col-na-box"><button class="btn btn-default" id="attribute-available-input-'+attributeSequence[stage6DisplayScaleCounter]+'">N.A.</button></div></div>');
			
			//Enable button click
			stage6EnableButton('attribute-available-input-'+attributeSequence[stage6DisplayScaleCounter]);
            
			stage6DisplayScaleCounter++;
		}
		
		//Activate the sliders
		stage6ActivateSliders();
	}
	
	function stage6EnableButton(DIVidentifier){
        
        debug("stage6 stage6EnableButton() running");
        
        $("#"+DIVidentifier).one("click", function(){
            
            debug("stage6EnableButton() - click activated");
            
            var checkAvailbility = $("#"+DIVidentifier).hasClass('active');
            
            if(checkAvailbility){
            	debug("btn active detected");
                $("#"+DIVidentifier).removeClass('active');
                $("#"+DIVidentifier).parent().parent().find('.slider-overlay').remove();
                
                stage6EnableButton(DIVidentifier);
            }else{
            	debug("btn active NOT detected");
                $("#"+DIVidentifier).addClass('active');
                $("#"+DIVidentifier).parent().parent().find('.slider-location').append("<div class='slider-overlay'></div>");
                
                stage6EnableButton(DIVidentifier);
            }
        });
    }
	
	function stage6DisplayScaleOrderingOutput(order, AttributePosition){
		
		debug("Stage6 - stage6DisplayScaleOrderingOutput() running");
		
		//Prepare the output array
		var output = [];
		
		//(1: will be used for order Original Attribute vs Opposite Attribute, 2: will be used for order Opposite Attribute vs Original Attribute)
		if(order == 1){
			output[0] = attributedata[attributeSequence[AttributePosition]];
			output[1] = attributedataopp[attributeSequence[AttributePosition]];
		}else if(order == 2){
			output[0] = attributedataopp[attributeSequence[AttributePosition]];
			output[1] = attributedata[attributeSequence[AttributePosition]];			
		}
		
		return output;
		
	}
	
	
	function stage6ActivateSliders(){
	
		debug("Stage6 - stage6ActivateSliders() running");
	
		$(".slider-input").val("");
		$(".slider")
		                
		.slider({
			step: 0.1,
			min: 0, 
			max: 10,
			values: [5.0],
			slide: function(event, ui){
				$(this).parent().children(".slider-input").val(ui.value.toFixed(1));
				
				debug("Stage6 - handler works");
				$(this).find(".ui-slider-handle").show();
				
				if(ui.value < 1){
					$(this).parent().parent().parent().parent().find('.stage6-col-left-align').css('font-weight','900');
					$(this).parent().parent().parent().parent().find('.stage6-col-right-align').css('font-weight','100');
				}
				else if((ui.value >= 1) && (ui.value < 1.5)){
					$(this).parent().parent().parent().parent().find('.stage6-col-left-align').css('font-weight','800');
					$(this).parent().parent().parent().parent().find('.stage6-col-right-align').css('font-weight','100');
				}
				else if((ui.value >= 1.5) && (ui.value < 2)){
					$(this).parent().parent().parent().parent().find('.stage6-col-left-align').css('font-weight','700');
					$(this).parent().parent().parent().parent().find('.stage6-col-right-align').css('font-weight','100');
				}
				else if((ui.value >= 2) && (ui.value < 2.5)){
					$(this).parent().parent().parent().parent().find('.stage6-col-left-align').css('font-weight','600');
					$(this).parent().parent().parent().parent().find('.stage6-col-right-align').css('font-weight','100');
				}
				else if((ui.value >= 2.5) && (ui.value < 3)){
					$(this).parent().parent().parent().parent().find('.stage6-col-left-align').css('font-weight','500');
					$(this).parent().parent().parent().parent().find('.stage6-col-right-align').css('font-weight','100');
				}
				else if((ui.value >= 3) && (ui.value < 3.5)){
					$(this).parent().parent().parent().parent().find('.stage6-col-left-align').css('font-weight','400');
					$(this).parent().parent().parent().parent().find('.stage6-col-right-align').css('font-weight','100');
				}
				else if((ui.value >= 3.5) && (ui.value < 4)){
					$(this).parent().parent().parent().parent().find('.stage6-col-left-align').css('font-weight','300');
					$(this).parent().parent().parent().parent().find('.stage6-col-right-align').css('font-weight','100');
				}
				else if((ui.value >= 4) && (ui.value < 4.5)){
					$(this).parent().parent().parent().parent().find('.stage6-col-left-align').css('font-weight','200');
					$(this).parent().parent().parent().parent().find('.stage6-col-right-align').css('font-weight','100');
				}
				else if((ui.value >= 4.5) && (ui.value < 5)){
					$(this).parent().parent().parent().parent().find('.stage6-col-left-align').css('font-weight','100');
					$(this).parent().parent().parent().parent().find('.stage6-col-right-align').css('font-weight','100');
				}
				else if((ui.value >= 5) && (ui.value < 5.5)){
					$(this).parent().parent().parent().parent().find('.stage6-col-left-align').css('font-weight','100');
					$(this).parent().parent().parent().parent().find('.stage6-col-right-align').css('font-weight','100');
				}
				else if((ui.value >= 5.5) && (ui.value < 6)){
					$(this).parent().parent().parent().parent().find('.stage6-col-left-align').css('font-weight','100');
					$(this).parent().parent().parent().parent().find('.stage6-col-right-align').css('font-weight','200');
				}
				else if((ui.value >= 6) && (ui.value < 6.5)){
					$(this).parent().parent().parent().parent().find('.stage6-col-left-align').css('font-weight','100');
					$(this).parent().parent().parent().parent().find('.stage6-col-right-align').css('font-weight','300');
				}
				else if((ui.value >= 6.5) && (ui.value < 7)){
					$(this).parent().parent().parent().parent().find('.stage6-col-left-align').css('font-weight','100');
					$(this).parent().parent().parent().parent().find('.stage6-col-right-align').css('font-weight','400');
				}
				else if((ui.value >= 7) && (ui.value < 7.5)){
					$(this).parent().parent().parent().parent().find('.stage6-col-left-align').css('font-weight','100');
					$(this).parent().parent().parent().parent().find('.stage6-col-right-align').css('font-weight','500');
				}
				else if((ui.value >= 7.5) && (ui.value < 8)){
					$(this).parent().parent().parent().parent().find('.stage6-col-left-align').css('font-weight','100');
					$(this).parent().parent().parent().parent().find('.stage6-col-right-align').css('font-weight','600');
				}
				else if((ui.value >= 8) && (ui.value < 8.5)){
					$(this).parent().parent().parent().parent().find('.stage6-col-left-align').css('font-weight','100');
					$(this).parent().parent().parent().parent().find('.stage6-col-right-align').css('font-weight','700');
				}
				else if((ui.value >= 8.5) && (ui.value < 9)){
					$(this).parent().parent().parent().parent().find('.stage6-col-left-align').css('font-weight','100');
					$(this).parent().parent().parent().parent().find('.stage6-col-right-align').css('font-weight','800');
				}
				else if(ui.value >= 9){
					$(this).parent().parent().parent().parent().find('.stage6-col-left-align').css('font-weight','100');
					$(this).parent().parent().parent().parent().find('.stage6-col-right-align').css('font-weight','900');
				}
				
				
				$(this).parent().parent().parent().parent().find('.stage6-col-left-align').css('color',colorList[55-Math.round((ui.value*10)/2)]);
				$(this).parent().parent().parent().parent().find('.stage6-col-right-align').css('color',colorList[Math.round((ui.value*10)/2)]);
			} 
		})
		                
		.slider("pips", {
			rest: "label",
			step: 10
		})
		                
		.slider("float");

		//first hide the scale
		$(".ui-slider-handle").hide();
	}
	
	function stage6SaveScaleData(PageNumber){
		
		//Parse actual company sequence
		var tempArraySelectedID = companySequence[parseInt(PageNumber)];

		
		debug("Stage6 - stage6SaveScaleData() running, tempArraySelectedID: " + tempArraySelectedID);
		
		//Create the empty array
		finalScale[tempArraySelectedID] = [];
		
		//Push all the values into the empty array
		$(".slider-row").each(function(){
			
            var checkButtonValue = $(this).find('.btn-default').hasClass('active');
            debug("Stage 6 - checkButtonValue: "+ checkButtonValue);
            
            if(checkButtonValue){
                //DO NOT SAVE VALUE, SAVE 'NA'
                var thisInternalValue = 'NA';
                var thisLocationIDAttribute = parseInt($(this).find('.slider-input').attr('id').replace(/attribute-slider-input-/,''),10);
                
                finalScale[tempArraySelectedID][thisLocationIDAttribute] = thisInternalValue;
                
                debug("Stage6 - stage6SaveScaleData() for location:" + thisLocationIDAttribute + ", slider-input value: "+thisInternalValue);
            }else{
                //SAVE VALUE
                var thisInternalValue = $(this).find('.slider-input').val();
                var thisLocationIDAttribute = parseInt($(this).find('.slider-input').attr('id').replace(/attribute-slider-input-/,''),10);
                
                finalScale[tempArraySelectedID][thisLocationIDAttribute] = thisInternalValue;
                
                debug("Stage6 - stage6SaveScaleData() for location:" + thisLocationIDAttribute + ", slider-input value: "+thisInternalValue);
            }
            
		});
		
		debug("Stage6 - stage6SaveScaleData() sub-final array: "+JSON.stringify(finalScale));
		
	}
	
	function stage6CheckSliders(){
		
		//Check all the inputs
		debug("Stage6 - stage6CheckSliders() checking all sliders for value");
		
		debug("Stage 6 - stage6CheckSliders() by default no missing value until found");
		var stage6CheckSlidersDefault = 1;
        
		$(".slider-row").each(function(){
            
            var checkButtonValue = $(this).find('.btn-default').hasClass('active');
            
            debug("Stage 6 - checkButtonValue: "+ checkButtonValue);
            var thisInternalValue = $(this).find('.slider-input').val();
            
            if(!(thisInternalValue)){
                if(!(checkButtonValue)){
                    debug("Stage 6 - stage6CheckSliders() missing value found");
                    stage6CheckSlidersDefault = 0;
                }
            }
 
		});
		
		return stage6CheckSlidersDefault;
	}
	
	function stage6RunDialog(){
		$( "#stage6-dialog-message" ).dialog( "open" );
	}
	
	$(function(){
		$( "#stage6-dialog-message" ).dialog({
			autoOpen: false,
			modal: true,
			buttons: {
				Ok: function() {
					$(this).dialog( "close" );
				}
			}
		});
	});
});
</script>